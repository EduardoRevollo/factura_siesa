(this.webpackJsonpfactura_siesa=this.webpackJsonpfactura_siesa||[]).push([[0],{24:function(e,t,a){e.exports=a(42)},30:function(e,t,a){},42:function(e,t,a){"use strict";a.r(t);var n=a(0),r=a.n(n),o=a(19),s=a.n(o),c=a(11),i=a(7),l=a(8),u=a(9),m=a(13),d=a(12),h=a(1),g=(a(29),a(30),new(function(){function e(){Object(i.a)(this,e)}return Object(l.a)(e,[{key:"login",value:function(e,t){localStorage.setItem("user",JSON.stringify({username:e,password:t}))}},{key:"getToken",value:function(){var e=JSON.stringify({Username:"ecocapital_pst",Password:"FactInt22+*"});return fetch("https://integracioneseco.co/ApiFacturas/api/login/authenticate",{method:"POST",body:e,headers:{"Content-Type":"application/json"},redirect:"follow"}).then((function(e){return e.json()})).then((function(e){return e.toString()})).catch((function(e){return console.log("error",e)}))}},{key:"getFolio",value:function(e,t,a){return fetch("https://integracioneseco.co/ApiFacturas/api/facturas/getConsultaFacturas?f_id_cia="+e+"&f_nit="+t,{method:"GET",headers:{Authorization:"Bearer "+a},redirect:"follow"}).then((function(e){return e.json()})).catch((function(e){return console.log("error",e)}))}},{key:"getFactura",value:function(e,t){var a=JSON.stringify({f_id_cia:1,f_tipo_documento:"1",f_folio:e});return fetch("https://integracioneseco.co/ApiFacturas/api/facturas/postConsultaDocumentoPDF",{method:"POST",body:a,headers:{Authorization:"Bearer "+t,"Content-Type":"application/json"},redirect:"follow"}).then((function(e){return e.json()})).catch((function(e){return console.log("error",e)}))}},{key:"logout",value:function(){localStorage.removeItem("user")}},{key:"getCurrentUser",value:function(){return JSON.parse(localStorage.getItem("user"))}}]),e}())),f=a(20),p=a.n(f),v=a(15),b=a.n(v),E=a(21),y=a.n(E),w=function(e){if(!e)return r.a.createElement("div",{className:"alert alert-danger",role:"alert"},"This field is required!")},k=function(e){Object(m.a)(a,e);var t=Object(d.a)(a);function a(e){var n;return Object(i.a)(this,a),(n=t.call(this,e)).handleLogin=n.handleLogin.bind(Object(u.a)(n)),n.onChangeUsername=n.onChangeUsername.bind(Object(u.a)(n)),n.onChangePassword=n.onChangePassword.bind(Object(u.a)(n)),n.state={username:"",password:"",loading:!1,message:""},n}return Object(l.a)(a,[{key:"onChangeUsername",value:function(e){this.setState({username:e.target.value})}},{key:"onChangePassword",value:function(e){this.setState({password:e.target.value})}},{key:"handleLogin",value:function(e){var t=this;e.preventDefault(),this.setState({message:"",loading:!0}),this.form.validateAll(),0===this.checkBtn.context._errors.length?(localStorage.setItem("username",this.state.username),localStorage.setItem("password",this.state.password),g.login(this.state.username,this.state.password),g.getToken().then((function(e){console.log(e),localStorage.setItem("token",e),g.getFolio(t.state.username,t.state.password,e).then((function(e){if(console.log(e),"success"===e.result){var a=e.detail[0].f_folio.toString();localStorage.setItem("folio",a),t.props.history.push("/factura_siesa/profile"),window.location.reload()}else t.setState({loading:!1}),console.log("Usuario o contrase\xf1a incorrectos")}))}))):this.setState({loading:!1})}},{key:"render",value:function(){var e=this;return r.a.createElement("div",{className:"col-md-12"},r.a.createElement("div",{className:"card card-container"},r.a.createElement("img",{src:"//ssl.gstatic.com/accounts/ui/avatar_2x.png",alt:"profile-img",className:"profile-img-card"}),r.a.createElement(p.a,{onSubmit:this.handleLogin,ref:function(t){e.form=t}},r.a.createElement("div",{className:"form-group"},r.a.createElement("label",{htmlFor:"username"},"Username"),r.a.createElement(b.a,{type:"text",className:"form-control",name:"username",value:this.state.username,onChange:this.onChangeUsername,validations:[w]})),r.a.createElement("div",{className:"form-group"},r.a.createElement("label",{htmlFor:"password"},"Password"),r.a.createElement(b.a,{type:"password",className:"form-control",name:"password",value:this.state.password,onChange:this.onChangePassword,validations:[w]})),r.a.createElement("div",{className:"form-group"},r.a.createElement("button",{className:"btn btn-primary btn-block",disabled:this.state.loading},this.state.loading&&r.a.createElement("span",{className:"spinner-border spinner-border-sm"}),r.a.createElement("span",null,"Login"))),this.state.message&&r.a.createElement("div",{className:"form-group"},r.a.createElement("div",{className:"alert alert-danger",role:"alert"},this.state.message)),r.a.createElement(y.a,{style:{display:"none"},ref:function(t){e.checkBtn=t}}))))}}]),a}(n.Component),O=function(e){Object(m.a)(a,e);var t=Object(d.a)(a);function a(e){var n;return Object(i.a)(this,a),(n=t.call(this,e)).state={redirect:null,userReady:!1,currentUser:{username:""}},n}return Object(l.a)(a,[{key:"componentDidMount",value:function(){var e=g.getCurrentUser();e?(this.setState({currentUser:e,userReady:!0}),g.getFactura(localStorage.getItem("folio"),localStorage.getItem("token")).then((function(e){var t=e.detail[0].f_bas64_rg.toString();localStorage.setItem("base64",t);var a=document.createElement("object");a.style.width="100%",a.style.height="842pt",a.type="application/pdf",a.data="data:application/pdf;base64,"+t,document.body.appendChild(a)}))):this.setState({redirect:"/login"})}},{key:"render",value:function(){return this.state.redirect?r.a.createElement(h.a,{to:this.state.redirect}):null}}]),a}(n.Component),S={on:function(e,t){document.addEventListener(e,(function(e){return t(e.detail)}))},dispatch:function(e,t){document.dispatchEvent(new CustomEvent(e,{detail:t}))},remove:function(e,t){document.removeEventListener(e,t)}},N=function(e){Object(m.a)(a,e);var t=Object(d.a)(a);function a(e){var n;return Object(i.a)(this,a),(n=t.call(this,e)).logOut=n.logOut.bind(Object(u.a)(n)),n.state={showModeratorBoard:!1,showAdminBoard:!1,currentUser:void 0},n}return Object(l.a)(a,[{key:"componentDidMount",value:function(){var e=this,t=g.getCurrentUser();t&&this.setState({currentUser:t,showModeratorBoard:!0,showAdminBoard:!1}),S.on("logout",(function(){e.logOut()}))}},{key:"componentWillUnmount",value:function(){S.remove("logout")}},{key:"logOut",value:function(){g.logout(),this.setState({showModeratorBoard:!1,showAdminBoard:!1,currentUser:void 0})}},{key:"render",value:function(){var e=this.state.currentUser;return r.a.createElement("div",null,r.a.createElement("nav",{className:"navbar navbar-expand navbar-dark bg-dark"},e?r.a.createElement("div",{className:"navbar-nav ml-auto"},r.a.createElement("li",{className:"nav-item"},r.a.createElement(c.b,{to:"/profile",className:"nav-link"},e.username)),r.a.createElement("li",{className:"nav-item"},r.a.createElement("a",{href:"/factura_siesa/login",className:"nav-link",onClick:this.logOut},"LogOut"))):r.a.createElement("div",{className:"navbar-nav ml-auto"},r.a.createElement("li",{className:"nav-item"},r.a.createElement(c.b,{to:"/login",className:"nav-link"},"Login")))),r.a.createElement("div",{className:"container mt-3"},r.a.createElement(h.d,null,r.a.createElement(h.b,{exact:!0,path:"/",component:k}),r.a.createElement(h.b,{exact:!0,path:"/login",component:k}),r.a.createElement(h.b,{exact:!0,path:"/profile",component:O}))))}}]),a}(n.Component);s.a.render(r.a.createElement(c.a,null,r.a.createElement(N,null)),document.getElementById("root"))}},[[24,1,2]]]);
//# sourceMappingURL=main.aef9c92a.chunk.js.map